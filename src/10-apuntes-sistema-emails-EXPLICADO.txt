================================================================================
                    10 - SISTEMA DE EMAILS (EXPLICADO PASO A PASO)
                         E-COMMERCE DE JOYERÃA
================================================================================

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    Â¿QUÃ‰ ES UN SISTEMA DE EMAILS?                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ANALOGÃA SIMPLE:
Imagina una tienda fÃ­sica donde trabaja Juan. Cuando un cliente compra:
1. Juan le da un recibo impreso
2. Juan le dice: "Te avisamos cuando llegue tu pedido"
3. Si el cliente tiene problemas, Juan le da su telÃ©fono

En una tienda ONLINE no hay "Juan", pero necesitas hacer lo mismo.
La soluciÃ³n: EMAILS AUTOMÃTICOS

Un Sistema de Emails = Un asistente automÃ¡tico que envÃ­a mensajes en el 
momento correcto, sin que tÃº hagas nada manualmente.

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    Â¿POR QUÃ‰ LO NECESITAS?                                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

HISTORIA REAL:
MarÃ­a compra un anillo de $15,000 en tu tienda online.

SIN EMAILS:
- DÃ­a 1: MarÃ­a compra â†’ No recibe confirmaciÃ³n â†’ Se preocupa
- DÃ­a 2: MarÃ­a llama: "Â¿Se procesÃ³ mi compra?"
- DÃ­a 3: Paquete enviado â†’ MarÃ­a no sabe
- DÃ­a 4: MarÃ­a llama: "Â¿DÃ³nde estÃ¡ mi pedido?"
- DÃ­a 5: Paquete llega â†’ MarÃ­a molesta por falta de comunicaciÃ³n
Resultado: Cliente insatisfecho + 2 llamadas al soporte

CON EMAILS:
- DÃ­a 1: Compra â†’ Email de confirmaciÃ³n â†’ MarÃ­a tranquila
- DÃ­a 3: Paquete enviado â†’ Email con tracking â†’ MarÃ­a sigue el paquete
- DÃ­a 5: Paquete llega â†’ Email de entrega â†’ MarÃ­a feliz
Resultado: Cliente feliz + 0 llamadas al soporte + Posible reseÃ±a positiva

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           LOS 5 EMAILS QUE VAMOS A IMPLEMENTAR                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. EMAIL DE BIENVENIDA ğŸ‰                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CUÃNDO: Cuando alguien se registra por primera vez
OBJETIVO: Hacer sentir bienvenido al nuevo usuario

PIÃ‰NSALO ASÃ:
Es como cuando entras a Starbucks y el barista te dice:
"Â¡Hola! Bienvenido, soy Pedro, Â¿en quÃ© te puedo ayudar?"

CONTENIDO:
âœ“ Saludo personalizado: "Hola MarÃ­a" (no "Hola usuario123")
âœ“ Mensaje amigable de bienvenida
âœ“ BotÃ³n para explorar productos
âœ“ Email de soporte

DÃ“NDE SE ENVÃA EN EL CÃ“DIGO:
AuthController.java â†’ register() â†’ despuÃ©s de crear el usuario

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. EMAIL DE CONFIRMACIÃ“N DE ORDEN ğŸ“¦                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CUÃNDO: Inmediatamente despuÃ©s de hacer una compra
OBJETIVO: Confirmar que la compra se procesÃ³ correctamente

PIÃ‰NSALO ASÃ:
Es el recibo digital. Como cuando compras en Amazon y te llega el email
con el resumen de tu compra.

CONTENIDO:
âœ“ NÃºmero de orden (#12345)
âœ“ Lista de productos con precios
âœ“ Total pagado
âœ“ DirecciÃ³n de envÃ­o
âœ“ Link para ver detalles

DÃ“NDE SE ENVÃA EN EL CÃ“DIGO:
OrderService.java â†’ createOrder() â†’ despuÃ©s de guardar la orden

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. EMAIL DE ENVÃO ğŸšš                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CUÃNDO: Cuando el paquete sale de la bodega
OBJETIVO: Informar que el pedido estÃ¡ en camino

PIÃ‰NSALO ASÃ:
Es como cuando FedEx te envÃ­a el mensaje: "Tu paquete estÃ¡ en camino"

CONTENIDO:
âœ“ ConfirmaciÃ³n de envÃ­o
âœ“ NÃºmero de tracking
âœ“ Link para rastrear el paquete
âœ“ Tiempo estimado de entrega

DÃ“NDE SE ENVÃA EN EL CÃ“DIGO:
OrderService.java â†’ updateOrderStatus() â†’ cuando status = SHIPPED

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. EMAIL DE ENTREGA âœ…                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CUÃNDO: Cuando el paquete llega a su destino
OBJETIVO: Confirmar entrega y pedir feedback

PIÃ‰NSALO ASÃ:
Es como cuando el vendedor te llama despuÃ©s de la entrega:
"Â¿LlegÃ³ todo bien? Â¿Nos dejas una reseÃ±a?"

CONTENIDO:
âœ“ ConfirmaciÃ³n de entrega
âœ“ Agradecimiento por la compra
âœ“ BotÃ³n para dejar reseÃ±a
âœ“ Email de soporte por si hay problemas

DÃ“NDE SE ENVÃA EN EL CÃ“DIGO:
OrderService.java â†’ updateOrderStatus() â†’ cuando status = DELIVERED

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. EMAIL DE RECUPERACIÃ“N DE CONTRASEÃ‘A ğŸ”                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CUÃNDO: Cuando alguien olvida su contraseÃ±a
OBJETIVO: Permitir recuperar acceso de forma segura

PIÃ‰NSALO ASÃ:
Es como cuando olvidas la combinaciÃ³n de tu casillero y el encargado
te da una llave temporal que solo funciona una vez.

CONTENIDO:
âœ“ Link especial con token (vÃ¡lido 1 hora)
âœ“ Instrucciones claras
âœ“ Advertencia de seguridad
âœ“ Nota: "Si no fuiste tÃº, ignora este email"

DÃ“NDE SE ENVÃA EN EL CÃ“DIGO:
PasswordResetService.java â†’ requestPasswordReset()

NOTA: Este email tiene su propia lÃ³gica compleja (explicada en apuntes 11)

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              CONFIGURAR GMAIL PARA ENVIAR EMAILS                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Â¿POR QUÃ‰ GMAIL?
Gmail es gratis, confiable, y fÃ¡cil de configurar. Usaremos tu cuenta personal
de Gmail para enviar los emails de tu tienda.

IMPORTANTE: NO usarÃ¡s tu contraseÃ±a normal de Gmail (eso serÃ­a inseguro).
UsarÃ¡s una "App Password" que es una contraseÃ±a especial solo para tu app.

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 1: ACTIVAR VERIFICACIÃ“N EN 2 PASOS                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Â¿QUÃ‰ ES ESTO?
Es una capa extra de seguridad. Gmail solo te deja crear App Passwords
si tienes esto activado.

CÃ“MO HACERLO:
1. Ve a: https://myaccount.google.com/security
2. Busca "VerificaciÃ³n en dos pasos"
3. Click en activar
4. Sigue los pasos (te pedirÃ¡ tu telÃ©fono)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 2: CREAR APP PASSWORD                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Â¿QUÃ‰ ES ESTO?
Una contraseÃ±a de 16 caracteres que Gmail genera especÃ­ficamente para que
tu aplicaciÃ³n pueda enviar emails. Es como una "llave" especial.

CÃ“MO HACERLO:
1. Ve a: https://myaccount.google.com/apppasswords
2. En "Seleccionar app": elige "Correo"
3. En "Seleccionar dispositivo": elige "Otro" y escribe "Joyeria API"
4. Click "Generar"
5. Gmail te mostrarÃ¡ una contraseÃ±a como: "abcd efgh ijkl mnop"
6. COPIA ESTA CONTRASEÃ‘A (la necesitarÃ¡s despuÃ©s)

âš ï¸ MUY IMPORTANTE:
- Esta contraseÃ±a se muestra UNA SOLA VEZ
- Si la pierdes, tendrÃ¡s que generar una nueva
- Quita los espacios al copiarla: "abcdefghijklmnop"

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 3: CONFIGURAR EN TU APLICACIÃ“N                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Abre tu archivo application.properties y agrega:

# ConfiguraciÃ³n de Gmail
spring.mail.host=smtp.gmail.com
spring.mail.port=587
spring.mail.username=tu-email@gmail.com
spring.mail.password=abcdefghijklmnop  â† Tu App Password (SIN espacios)
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.starttls.required=true

# InformaciÃ³n del remitente
app.email.from=JoyerÃ­a E-commerce <tu-email@gmail.com>
app.email.support=tu-email@gmail.com
app.frontend.url=http://localhost:3000

EXPLICACIÃ“N LÃNEA POR LÃNEA:

spring.mail.host=smtp.gmail.com
â†’ Servidor de Gmail para enviar emails

spring.mail.port=587
â†’ Puerto que usa Gmail (es el estÃ¡ndar)

spring.mail.username=tu-email@gmail.com
â†’ TU email de Gmail

spring.mail.password=abcdefghijklmnop
â†’ La App Password que copiaste (SIN espacios)

spring.mail.properties.mail.smtp.auth=true
â†’ Dice "sÃ­ necesito autenticarme con usuario y contraseÃ±a"

spring.mail.properties.mail.smtp.starttls.enable=true
â†’ Activa encriptaciÃ³n (por seguridad)

app.email.from=JoyerÃ­a E-commerce <tu-email@gmail.com>
â†’ Nombre que aparecerÃ¡ como remitente en los emails
â†’ DEBE ser el mismo email que username

app.email.support=tu-email@gmail.com
â†’ Email de soporte (donde los clientes pueden escribir)

app.frontend.url=http://localhost:3000
â†’ URL de tu frontend (para los links en los emails)

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                  CÃ“DIGO: CÃ“MO FUNCIONA POR DENTRO                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DEPENDENCIA NECESARIA (pom.xml)                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-mail</artifactId>
</dependency>

Â¿QUÃ‰ HACE ESTO?
Le da a tu aplicaciÃ³n la capacidad de enviar emails.
Es como instalar un "mÃ³dulo de envÃ­o de correo".

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EXCEPCIONES (Errores Personalizados)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Creamos 3 excepciones para manejar problemas con emails:

1. EmailSendException
   CUÃNDO: Falla el envÃ­o (problema de red, Gmail caÃ­do, etc.)
   EJEMPLO: "No se pudo conectar al servidor de Gmail"

2. InvalidEmailException
   CUÃNDO: El email tiene formato invÃ¡lido
   EJEMPLO: "usuario@" (le falta el dominio)

3. EmailConfigurationException
   CUÃNDO: Olvidaste configurar el email en properties
   EJEMPLO: spring.mail.username estÃ¡ vacÃ­o

Â¿POR QUÃ‰ CREAR EXCEPCIONES ESPECÃFICAS?
- Mensajes de error mÃ¡s claros para el usuario
- Facilita encontrar problemas cuando debuggeas
- Puedes manejar cada tipo de error de forma diferente

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EMAILSERVICE: EL CEREBRO DEL SISTEMA                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Este es el servicio principal que envÃ­a todos los emails.

MÃ‰TODOS PRINCIPALES:

1. validateEmail(String email)
   Â¿QUÃ‰ HACE? Verifica que el email tenga formato vÃ¡lido
   EJEMPLO: "usuario@gmail.com" âœ…  "usuario@" âŒ
   
2. checkEmailConfiguration()
   Â¿QUÃ‰ HACE? Verifica que hayas configurado Gmail correctamente
   SI NO: Lanza EmailConfigurationException
   
3. sendWelcomeEmail(User user)
   Â¿QUÃ‰ HACE? EnvÃ­a el email de bienvenida
   CUÃNDO SE LLAMA: Desde AuthController despuÃ©s del registro
   
4. sendOrderConfirmation(Order order)
   Â¿QUÃ‰ HACE? EnvÃ­a el email de confirmaciÃ³n de orden
   CUÃNDO SE LLAMA: Desde OrderService despuÃ©s de crear la orden
   
5. sendShippingNotification(Order order)
   Â¿QUÃ‰ HACE? EnvÃ­a el email de envÃ­o
   CUÃNDO SE LLAMA: Desde OrderService al cambiar estado a SHIPPED
   
6. sendDeliveryNotification(Order order)
   Â¿QUÃ‰ HACE? EnvÃ­a el email de entrega
   CUÃNDO SE LLAMA: Desde OrderService al cambiar estado a DELIVERED

DETALLE IMPORTANTE: @Async

Â¿QUÃ‰ ES @Async?
Es una anotaciÃ³n que hace que el mÃ©todo se ejecute en segundo plano.

SIN @Async:
Usuario registra â†’ Crear usuario (1 seg) â†’ Enviar email (3 seg) â†’ Responder
Total: 4 segundos (usuario esperando)

CON @Async:
Usuario registra â†’ Crear usuario (1 seg) â†’ Responder inmediatamente
                   â””â†’ Enviar email (3 seg) en paralelo
Total: 1 segundo (usuario ve respuesta rÃ¡pido)

Â¿POR QUÃ‰ ES IMPORTANTE?
- El usuario ve respuesta instantÃ¡nea
- Si el email falla, el registro NO falla
- Mejor experiencia de usuario

PARA HABILITAR @Async:
Crear archivo AsyncConfig.java:

@Configuration
@EnableAsync
public class AsyncConfig {
}

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ INTEGRACIÃ“N CON AUTHCONTROLLER                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

@RestController
@RequestMapping("/api/auth")
@RequiredArgsConstructor
public class AuthController {
    
    private final EmailService emailService;  â† Inyectar el servicio
    
    @PostMapping("/register")
    public ResponseEntity<AuthResponse> register(...) {
        
        // 1. Crear usuario en BD
        User registered = userService.registerUser(user);
        
        // 2. Enviar email (en segundo plano, no bloquea)
        try {
            emailService.sendWelcomeEmail(registered);
        } catch (Exception e) {
            // Log el error pero NO interrumpir el registro
            // El usuario YA fue registrado exitosamente
        }
        
        // 3. Retornar token JWT
        return ResponseEntity.ok(authResponse);
    }
}

PREGUNTA: Â¿Por quÃ© el try-catch?

RESPUESTA:
Imagina que Gmail estÃ¡ caÃ­do. Â¿QuÃ© prefieres?
A) El usuario NO puede registrarse (porque el email fallÃ³)
B) El usuario SÃ se registra (solo no recibe el email)

Respuesta correcta: B
El try-catch asegura que si el email falla, el registro sigue funcionando.

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                  TEMPLATES HTML (Emails Bonitos)                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Â¿POR QUÃ‰ HTML Y NO TEXTO PLANO?

TEXTO PLANO:
"Hola Maria, gracias por registrarte. Visita nuestra tienda: 
http://mitienda.com/products"

HTML:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [LOGO DE LA TIENDA]                        â”‚
â”‚  Â¡Bienvenida MarÃ­a! ğŸ’                      â”‚
â”‚  Gracias por unirte a JoyerÃ­a E-commerce   â”‚
â”‚  [BOTÃ“N: Explorar Productos]                â”‚
â”‚  Si tienes dudas: soporte@joyeria.com      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

El HTML se ve MUCHO mÃ¡s profesional.

ESTRUCTURA BÃSICA DE UN EMAIL HTML:

<!DOCTYPE html>
<html>
<head>
    <style>
        /* Estilos INLINE (no archivo CSS separado) */
        .header { background: blue; color: white; }
        .button { background: green; padding: 15px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Â¡Bienvenido!</h1>
    </div>
    <div class="content">
        <p>Hola {{nombre}}, ...</p>
        <a href="{{link}}" class="button">Ver Productos</a>
    </div>
</body>
</html>

IMPORTANTE:
- Los estilos van INLINE (dentro del mismo archivo)
- Usa variables como {{nombre}} que luego reemplazas con datos reales
- Prueba en Gmail, Outlook, etc. (se ven diferente en cada cliente)

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                  PROBLEMAS COMUNES Y SOLUCIONES                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PROBLEMA 1: "Email no configurado"                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SÃNTOMA:
Logs dicen: "âš ï¸ Email no configurado. Los emails NO se enviarÃ¡n."

CAUSAS:
- Olvidaste poner tu email en spring.mail.username
- Olvidaste poner la App Password en spring.mail.password

SOLUCIÃ“N:
Verifica application.properties:
spring.mail.username=TU-EMAIL-AQUI@gmail.com  â† Â¿EstÃ¡ completo?
spring.mail.password=abcdefghijklmnop          â† Â¿EstÃ¡ sin espacios?

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PROBLEMA 2: "Authentication failed"                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SÃNTOMA:
Error: "535-5.7.8 Username and Password not accepted"

CAUSAS:
- App Password incorrecta
- Copiaste con espacios
- No activaste verificaciÃ³n en 2 pasos

SOLUCIÃ“N:
1. Ve a https://myaccount.google.com/apppasswords
2. BORRA la App Password vieja
3. Genera una NUEVA
4. Copia SIN ESPACIOS: "abcd efgh" â†’ "abcdefgh"
5. Pega en application.properties

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PROBLEMA 3: Los emails NO LLEGAN                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SÃNTOMA:
Logs dicen "âœ… Email enviado" pero no llega a tu bandeja

CAUSAS Y SOLUCIONES:

1. EstÃ¡ en SPAM
   â†’ Revisa la carpeta de spam
   â†’ Gmail puede ponerlo ahÃ­ las primeras veces

2. Gmail tarda
   â†’ Espera 5-10 minutos
   â†’ A veces hay retraso en la entrega

3. Busca manualmente
   â†’ En Gmail, busca: from:tu-email@gmail.com
   â†’ Busca: subject:Bienvenido

4. Email "from" incorrecto
   â†’ app.email.from DEBE ser el mismo que spring.mail.username
   â†’ Si no, Gmail lo rechaza

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                        MEJORES PRÃCTICAS                                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… SIEMPRE usa @Async
   â†’ Los emails no deben bloquear operaciones principales

âœ… SIEMPRE maneja excepciones
   â†’ Si el email falla, el registro/compra debe seguir funcionando

âœ… SIEMPRE valida el formato del email
   â†’ Antes de intentar enviar

âœ… SIEMPRE usa HTML
   â†’ Emails bonitos = mÃ¡s profesional

âœ… NUNCA uses tu contraseÃ±a normal de Gmail
   â†’ Solo App Password

âœ… NUNCA expongas errores de email al usuario
   â†’ Solo loguea en el servidor

âœ… NUNCA envÃ­es emails sÃ­ncronos
   â†’ Siempre @Async

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                           RESUMEN FINAL                                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

LO QUE IMPLEMENTAMOS:
âœ… 5 tipos de emails diferentes
âœ… ConfiguraciÃ³n de Gmail con App Password
âœ… EmailService con envÃ­o asÃ­ncrono
âœ… 3 excepciones personalizadas
âœ… Templates HTML profesionales
âœ… IntegraciÃ³n con controllers
âœ… Manejo robusto de errores

BENEFICIOS:
âœ… Clientes informados en todo momento
âœ… Menos llamadas al soporte
âœ… Imagen mÃ¡s profesional
âœ… Mejor experiencia de usuario
âœ… Confianza y credibilidad

ARCHIVOS CREADOS/MODIFICADOS:
- exception/EmailSendException.java
- exception/InvalidEmailException.java
- exception/EmailConfigurationException.java
- service/EmailService.java
- config/AsyncConfig.java
- controller/AuthController.java (+ emailService)
- service/OrderService.java (+ emailService)
- application.properties (configuraciÃ³n Gmail)

================================================================================
                            FIN DE APUNTES
================================================================================
